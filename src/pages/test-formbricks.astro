---
---

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formbricks æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        h1 { color: #333; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>ğŸ”§ Formbricks è°ƒè¯•å·¥å…·</h1>

    <div id="status"></div>

    <h2>æ“ä½œæŒ‰é’®</h2>
    <button onclick="clearCache()">æ¸…é™¤æ‰€æœ‰ç¼“å­˜</button>
    <button onclick="checkStatus()">æ£€æŸ¥çŠ¶æ€</button>
    <button onclick="showConfig()">æ˜¾ç¤ºé…ç½®</button>
    <button onclick="triggerEvent()">è§¦å‘æµ‹è¯•äº‹ä»¶</button>

    <h2>æ—¥å¿—è¾“å‡º</h2>
    <pre id="logs"></pre>

    <!-- Formbricks è„šæœ¬ -->
    <script>
        const logElement = document.getElementById('logs');
        const statusElement = document.getElementById('status');

        function log(message, type = 'info') {
            const timestamp = new Date().toISOString();
            const logLine = `[${timestamp}] ${message}\n`;
            logElement.textContent += logLine;
            console.log(message);
        }

        function clearCache() {
            let count = 0;
            Object.keys(localStorage).forEach(key => {
                if (key.includes('formbricks')) {
                    localStorage.removeItem(key);
                    count++;
                }
            });
            log(`æ¸…é™¤äº† ${count} ä¸ª Formbricks ç¼“å­˜é¡¹`);
            showStatus('success', `å·²æ¸…é™¤ ${count} ä¸ªç¼“å­˜é¡¹ï¼Œåˆ·æ–°é¡µé¢ä»¥é‡æ–°åˆå§‹åŒ–`);
        }

        function showStatus(type, message) {
            statusElement.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function checkStatus() {
            if (typeof window.formbricks === 'undefined') {
                log('âŒ Formbricks æœªåŠ è½½', 'error');
                showStatus('error', 'Formbricks æœªåŠ è½½');
                return;
            }

            log('âœ… Formbricks å·²åŠ è½½');
            log(`é…ç½®: ${JSON.stringify(window.formbricks.config || {}, null, 2)}`);
            showStatus('success', 'Formbricks å·²æˆåŠŸåŠ è½½');
        }

        function showConfig() {
            if (typeof window.formbricks === 'undefined') {
                log('âŒ Formbricks æœªåŠ è½½');
                return;
            }

            const config = window.formbricks.config || {};
            log('=== Formbricks é…ç½® ===');
            log(JSON.stringify(config, null, 2));

            // æ˜¾ç¤º localStorage ä¸­çš„æ‰€æœ‰ Formbricks æ•°æ®
            log('\n=== LocalStorage æ•°æ® ===');
            Object.keys(localStorage).forEach(key => {
                if (key.includes('formbricks')) {
                    log(`${key}: ${localStorage.getItem(key)}`);
                }
            });
        }

        function triggerEvent() {
            if (typeof window.formbricks === 'undefined') {
                log('âŒ Formbricks æœªåŠ è½½');
                showStatus('error', 'è¯·ç­‰å¾… Formbricks åŠ è½½');
                return;
            }

            log('è§¦å‘æµ‹è¯•äº‹ä»¶: test_event');
            window.formbricks.track('test_event', { page: 'test' });
            showStatus('info', 'å·²è§¦å‘ test_event äº‹ä»¶');
        }

        // åˆå§‹åŒ–
        log('=== Formbricks è°ƒè¯•å·¥å…·å¯åŠ¨ ===');
        log(`é¡µé¢ URL: ${window.location.href}`);
        log(`Hostname: ${window.location.hostname}`);
    </script>

    <!-- Formbricks SDK -->
    <script type="text/javascript">
        // æ¸…é™¤æ‰€æœ‰ Formbricks ç¼“å­˜
        log('æ¸…é™¤ Formbricks ç¼“å­˜...');
        Object.keys(localStorage).forEach(function(key) {
            if (key.includes('formbricks')) {
                localStorage.removeItem(key);
                log(`å·²åˆ é™¤: ${key}`);
            }
        });

        !(function () {
            var appUrl = "https://form.keveon.app";
            var environmentId = "cmheyc4dr0009qt01kj98n0kt";
            var t = document.createElement("script");
            t.type = "text/javascript";
            t.async = true;
            t.src = appUrl + "/js/formbricks.umd.cjs";

            log(`åŠ è½½ Formbricks SDK: ${t.src}`);

            t.onload = function () {
                log('Formbricks SDK åŠ è½½æˆåŠŸ');
                if (typeof window.formbricks !== "undefined") {
                    log('å¼€å§‹åˆå§‹åŒ– Formbricks...');
                    window.formbricks.init({
                        environmentId: environmentId,
                        apiHost: appUrl,
                        debug: true,
                    });
                    log('âœ… Formbricks åˆå§‹åŒ–å®Œæˆ');
                    showStatus('success', 'Formbricks å·²åˆå§‹åŒ–ï¼Œæ£€æŸ¥æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†æ—¥å¿—');

                    // è‡ªåŠ¨æ˜¾ç¤ºé…ç½®
                    setTimeout(() => {
                        showConfig();
                    }, 2000);
                } else {
                    log('âŒ window.formbricks æœªå®šä¹‰');
                    showStatus('error', 'Formbricks å¯¹è±¡æœªåˆ›å»º');
                }
            };

            t.onerror = function() {
                log('âŒ Formbricks SDK åŠ è½½å¤±è´¥');
                showStatus('error', 'SDK åŠ è½½å¤±è´¥');
            };

            var e = document.getElementsByTagName("script")[0];
            e.parentNode.insertBefore(t, e);
        })();
    </script>
</body>
</html>
